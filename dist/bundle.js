window.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector(".header__data-cart"),e=document.querySelector(".cart"),n=document.querySelector(".card__items"),a=document.querySelector(".cart__inner"),r=document.querySelector(".details"),c=document.querySelector(".details__test");console.log(c);let s=location.hash.substring(1);t.addEventListener("click",(()=>{e.classList.contains("cart")&&e.classList.toggle("active")}));const i="http://localhost:3001/items",o="http://localhost:3001/cart";let d=[];const l=async t=>{try{return await fetch(t).then((t=>{if(!t.ok)throw Error("Error");return t.json()}))}catch(t){console.log("Error:",t)}};l(i).then((t=>t.forEach((t=>(({id:t,name:e,images:a,description:r,price:c})=>{const s=document.createElement("div");s.classList.add("card__item"),s.id=t,s.innerHTML=`\n        <img class='card__images' width=250 src="${a}" alt="${e}">\n        <a href="../details.html#${t}">\n          <h3 class='card__name'>${e}</h3>\n        </a>\n        <div>\n          <p class='card__description'>${r}</p>\n          <span class='card__price'>${c}</span>\n          <button data-id='add' class='card__btn'>Добавить в корзину</button>\n        </div>\n      `,n.insertAdjacentElement("beforeend",s)})(t))))),(async(t,e,n)=>{try{await l(i).then((t=>{(t=>{t.forEach((t=>{r.insertAdjacentHTML("beforeend",`\n        <div class='container'>\n          <h1 class='details__name'>${t.name}</h1>\n          <p class='details__price'>${t.price}</p>\n          <span class='details__description'>${t.description}</span>\n          <div>\n            <button data-id='add' class='details__add'>Добавить в корзину</button>\n          </div>\n        </div>\n      `)}))})(n?t.filter((t=>t.id===n)):t)}))}catch(t){console.log("Error",t)}})(0,0,s),window.addEventListener("hashchange",(()=>{s=location.hash.substring(1)}));const h=t=>(a.innerHTML="",t.forEach((t=>{const e=document.createElement("li");e.id=t.id,e.classList.add("cart__item"),e.innerHTML=`\n        <div class="cart__item-row">\n          <img width="120" height="120" src="${t.images}" alt="">\n          <div>\n            <span class="cart__title">${t.name}</span>\n            <p class="cart__price">${t.price}</p>\n          </div>\n        </div>\n        <div>\n          <img class='cart__remove' data-id='remove' width="25" height="25" src="../assets/images/delete-icon.svg" alt="">\n        </div>\n      `,a.insertAdjacentElement("beforeend",e)})),t),_=async t=>{try{if("add"===t.target.dataset.id){const e=t.target.closest(".card__item"),n=e.id,a=e.querySelector(".card__name").textContent,r=e.querySelector(".card__price").textContent,c=e.querySelector(".card__images").src,s={id:n,name:a,price:r,images:c,count:1};d.find((t=>t.id===n))?d.find((t=>t.id===n?{...t,count:t.count+1}:t)):await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((t=>{if(201===t.status)return t.json();throw new Error("Error")})).then((t=>{d.push(t),h(d)}))}}catch(t){console.log("Error:",t)}};n.addEventListener("click",_),a.addEventListener("click",(async t=>{try{if("remove"===t.target.dataset.id){const e=t.target.closest(".cart__item"),n=e.id;d=d.filter((t=>t.id!==n)),await fetch(`${o}/${n}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),e.remove()}}catch(t){console.log("Error:",t)}})),r.addEventListener("click",_),(async t=>{try{fetch("http://localhost:3001/cart").then((t=>{if(!t.ok)throw Error("Error");return t.json()})).then((t=>{h(t)}))}catch(t){console.log("Error:",t)}})()}));